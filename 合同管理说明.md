# 合同管理说明文档

## 📁 文件结构

```
项目根目录/
├── src/main/resources/contracts/          # 后端合同数据文件
│   ├── labor-contract.json               # 劳动合同
│   ├── housing-lease-contract.json       # 房屋租赁合同
│   ├── purchase-sale-contract.json       # 购销合同
│   ├── tech-development-contract.json    # 技术开发合同
│   └── service-contract.json             # 服务合同
└── frontend/src/data/
    └── contracts.js                      # 前端合同数据文件
```

## 🔄 合同数据更新流程

### 1. 更新后端合同数据

#### 方法1：直接编辑JSON文件（推荐）
1. 找到对应的合同文件，如 `labor-contract.json`
2. 编辑文件内容：
   - 修改 `content` 数组中的合同条款
   - 调整 `errorIndices` 数组中的错误索引
   - 更新 `errorExplanations` 中的错误说明
3. 保存文件
4. 调用重新加载接口：`POST /api/game/reload-contracts`

#### 方法2：通过API重新加载
```bash
curl -X POST http://localhost:8080/api/game/reload-contracts
```

### 2. 更新前端合同数据

1. 编辑 `frontend/src/data/contracts.js` 文件
2. 修改对应合同的数据
3. 重新构建前端项目

## 📝 合同数据格式说明

### JSON文件结构
```json
{
  "id": 1,                    // 合同ID（必须唯一）
  "title": "劳动合同",         // 合同标题
  "description": "合同描述",   // 合同描述
  "totalErrors": 5,           // 错误点总数
  "errorIndices": [6, 10, 14, 18, 20],  // 错误句子索引（从0开始）
  "content": [                // 合同内容数组
    "第一条 合同条款...",
    "第二条 合同条款...",
    // ... 更多条款
  ],
  "errorExplanations": {      // 错误说明映射
    "6": "试用期超过法定最长期限",
    "10": "缺少'及行政法规'",
    // ... 更多错误说明
  }
}
```

### 重要注意事项

1. **索引从0开始**：`errorIndices` 中的数字对应 `content` 数组的索引
2. **索引必须有效**：确保所有错误索引都在 `content` 数组范围内
3. **数据一致性**：`totalErrors` 应该等于 `errorIndices.length`
4. **错误说明完整**：每个错误索引都应该有对应的说明

## 🛠️ 添加新合同

### 1. 创建后端JSON文件
在 `src/main/resources/contracts/` 目录下创建新的JSON文件，如 `new-contract.json`

### 2. 更新GameController
在 `GameController.java` 的 `loadContractsFromFiles()` 方法中添加新文件路径：

```java
String[] contractFiles = {
    "contracts/labor-contract.json",
    "contracts/housing-lease-contract.json", 
    "contracts/purchase-sale-contract.json",
    "contracts/tech-development-contract.json",
    "contracts/service-contract.json",
    "contracts/new-contract.json"  // 添加新合同
};
```

### 3. 更新前端数据
在 `frontend/src/data/contracts.js` 中添加新合同数据

### 4. 重新加载
调用 `POST /api/game/reload-contracts` 接口重新加载数据

## 🔧 合同内容修改指南

### 修改合同条款
1. 在 `content` 数组中修改对应的条款文本
2. 如果修改了条款数量，需要相应调整 `errorIndices`
3. 确保错误索引仍然指向正确的条款

### 修改错误点
1. 调整 `errorIndices` 数组中的索引值
2. 更新 `errorExplanations` 中对应的错误说明
3. 确保 `totalErrors` 与错误点数量一致

### 修改合同标题和描述
1. 更新 `title` 字段
2. 更新 `description` 字段
3. 这些修改不影响游戏逻辑

## 🚨 常见问题和解决方案

### 问题1：合同加载失败
**症状**：控制台显示"加载合同文件失败"
**解决方案**：
1. 检查JSON文件格式是否正确
2. 确认文件路径是否正确
3. 检查文件编码是否为UTF-8

### 问题2：错误索引超出范围
**症状**：游戏运行时出现数组越界错误
**解决方案**：
1. 检查 `errorIndices` 中的索引值
2. 确保所有索引都在 `content` 数组范围内
3. 重新计算并调整错误索引

### 问题3：合同数据不一致
**症状**：前端显示的错误点数量与后端不符
**解决方案**：
1. 检查 `totalErrors` 字段
2. 确认 `errorIndices` 数组长度
3. 确保前后端数据同步

## 📋 合同更新检查清单

更新合同后，请检查以下项目：

- [ ] JSON文件格式正确
- [ ] 错误索引在有效范围内
- [ ] 错误说明完整且准确
- [ ] 前后端数据一致
- [ ] 重新加载接口调用成功
- [ ] 游戏功能正常
- [ ] 错误点显示正确

## 🔄 热更新功能

系统支持合同数据的热更新，无需重启应用：

1. 修改合同文件
2. 调用 `POST /api/game/reload-contracts`
3. 数据立即生效

## 💡 最佳实践

1. **备份原文件**：修改前先备份原始合同文件
2. **逐步测试**：每次只修改一个合同，测试无误后再修改下一个
3. **版本控制**：将合同文件纳入版本控制系统
4. **定期检查**：定期检查合同数据的完整性和准确性
5. **用户反馈**：根据用户反馈调整合同内容和错误点

## 📞 技术支持

如果在合同管理过程中遇到问题，请：

1. 检查控制台错误日志
2. 验证JSON文件格式
3. 确认数据一致性
4. 联系开发团队获取支持
